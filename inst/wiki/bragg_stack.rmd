Reproducing Fig. 6.6, p. 188 of Mac Leod's Thin Film Optical Filters.
The structure is a stack of lambda/4 layers of alternating indices nH (high) and nL (low) on a glass substrate. 

```{r , echo=FALSE,results='hide'}
opts_chunk$set(fig.path="bragg/",
               warning=FALSE,error=FALSE,message=FALSE,tidy=TRUE)
library(ggplot2)
theme_set(theme_minimal() + theme(panel.border=element_rect(fill=NA)))
```

#### Setting up

```{r , results='hide'}
library(planar)
library(ggplot2)
require(reshape2)
require(plyr)

make_stack <- function(n = 3, wavelength=seq(300, 700),
                      lambda0 = 500, thickness = lambda0/4, 
                      nH=2.3, nL=1.38, nS=1.52,
                      angle=0){

  epsilon.list <- as.list(c(1, rep(c(nL, nH)^2, n), nS))
  thickness.list <- c(0, rep(thickness/c(nL, nH), n), 0)
  
  recursive_fresnelcpp(wavelength=wavelength, angle=angle,
                       epsilon=epsilon.list, thickness=thickness.list,
                       polarisation='p')

}
```
With increasing number of layers, the reflectivity stop-band becomes stronger, with a more rectangular transfer function. Side-bands also develop accordingly, however, with higher and higher frequency.

```{r simulation}

params <- expand.grid(n=c(2, 4, 8), angle=seq(0,pi/3, by=pi/6))
all <- mdply(params, make_stack)
all$angle.d <- 180/pi*all$angle

ggplot(all)+ facet_grid(angle.d ~ .)+
  geom_line(aes(2*pi/k0, R, colour=factor(n))) +
  labs(colour="layers") +
  scale_x_continuous("wavelength /nm")+
  scale_y_continuous("Reflectivity", expand=c(0,0), lim=c(0,1))

```
